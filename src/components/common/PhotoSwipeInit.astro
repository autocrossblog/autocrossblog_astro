---
--- 
<script>
  import PhotoSwipeLightbox from 'photoswipe/lightbox';
  import 'photoswipe/style.css';

  function isPhonePortrait() {
    return window.matchMedia('(max-width: 600px) and (orientation: portrait)').matches;
  }

  window.initPhotoSwipe = () => {
    const lightbox = new PhotoSwipeLightbox({
      gallery: '.gallery', // Ensure this matches the gallery container class
      children: 'a', // Ensure child elements are the anchor tags in the gallery
      initialZoomLevel: (zoomLevelObject) => {
        return isPhonePortrait() ? zoomLevelObject.vFill : zoomLevelObject.fit;
      },
      secondaryZoomLevel: (zoomLevelObject) => {
        return isPhonePortrait() ? zoomLevelObject.fit : 1;
      },
      pswpModule: () => import('photoswipe'),
    });

    // Add captions
    lightbox.on('uiRegister', () => {
      lightbox.pswp.ui.registerElement({
        name: 'custom-caption',
        className: 'pswp__custom-caption',
        appendTo: 'wrapper',
        html: '', // Placeholder for captions
        onInit: (el, pswp) => {
          pswp.on('change', () => {
            // Safely check for currSlide and data existence
            const currSlideElement = pswp.currSlide?.data?.element || null;

            let captionHTML = 'No caption available';
            if (currSlideElement) {
              const hiddenCaption = currSlideElement.getAttribute('data-pswp-description');
              captionHTML = hiddenCaption ? hiddenCaption : captionHTML;
            }

            el.innerHTML = captionHTML;
          });
        },
      });
    });

    lightbox.on('contentLoad', (e) => {
  const slide = e.slide;

  if (slide?.data?.element) {
    const srcset = slide.data.element.getAttribute('data-srcset');
    const img = slide.container?.querySelector('img');

    if (srcset && img) {
      img.setAttribute('srcset', srcset);
      img.setAttribute('sizes', '(max-width: 768px) 90vw, (max-width: 2000px) 50vw, 30vw');
      console.log('Applied srcset:', srcset);
    }
  } else {
    console.warn('Slide data or element is missing:', slide);
  }
});

    lightbox.init();
  };

  // Initialize the lightbox
  document.addEventListener('DOMContentLoaded', () => {
    window.initPhotoSwipe();
  });
  
</script>
