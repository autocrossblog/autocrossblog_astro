---
// Astro Frontmatter (if required)
---
<script>
  import PhotoSwipeLightbox from 'photoswipe/lightbox';
  import 'photoswipe/style.css';

  function isPhonePortrait() {
    return window.matchMedia('(max-width: 600px) and (orientation: portrait)').matches;
  }

  window.initPhotoSwipe = () => {
    const lightbox = new PhotoSwipeLightbox({
      gallery: '.gallery',
      children: 'a',
      initialZoomLevel: (zoomLevelObject) => {
        if (isPhonePortrait()) {
          return zoomLevelObject.vFill;
        } else {
          return zoomLevelObject.fit;
        }
      },
      secondaryZoomLevel: (zoomLevelObject) => {
        if (isPhonePortrait()) {
          return zoomLevelObject.fit;
        } else {
          return 1;
        }
      },
      pswpModule: () => import('photoswipe'),
    });

    // Add captions to PhotoSwipe
    lightbox.on('uiRegister', () => {
      lightbox.pswp.ui.registerElement({
        name: 'custom-caption',
        className: 'pswp__custom-caption',
        appendTo: 'wrapper',
        html: '', // Placeholder for caption content
        onInit: (el, pswp) => {
          pswp.on('change', () => {
            const currSlideElement = pswp.currSlide?.data?.element;

            let captionHTML = 'No caption available'; // Default fallback caption
            if (currSlideElement) {
              const hiddenCaption = currSlideElement.querySelector('.gallery-caption');
              if (hiddenCaption) {
                captionHTML = hiddenCaption.innerHTML;
              } else {
                const img = currSlideElement.querySelector('img');
                if (img) {
                  captionHTML = img.getAttribute('alt') || captionHTML;
                }
              }
            }

            // Update the custom caption element
            el.innerHTML = captionHTML;
          });
        },
      });
    });

    lightbox.init();
  };

  window.initPhotoSwipe();
</script>

